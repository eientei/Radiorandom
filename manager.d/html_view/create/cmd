#!/bin/sh

info_cmd="Creates mview"

map() {
(
        file="$1"; shift
        res="$cmake_dir/${outdir}${file#*/}.cmake" 
	res="`dirname "$res"`/${view_level}`basename "$res"`"
	echo "$res"
)
}

main() {
(
	override="false"
	if [ "$1" = "-f" ]; then
		override="true"
		shift
	fi
	view_level="$1"; shift
	if [ ${#@} -lt 1 ]; then
		echo "Please specify skin name"
		return 1
	fi

	view_level="`printf "%04d\n" "$view_level"`"

	name="`echo "root_$@" | tr ' ' '_'`"
	include="`echo "$@" | tr ' ' '/'`"
	uses="`echo "$@" | sed 's/ /::/g'`"

	file="$src_dirs/`echo "$@" | tr ' ' '/'`.tmpl"

	if [ -e "$file" ] && [ "$override" != "true" ]; then
		echo "File '$file' already exists. Refusing to proceed."
		echo "Use -f to override."
		return 1
	fi


	mkdir -p `dirname "$file"`

cat <<EOF > "$file"
<% c++ #include "${include}.h" %>
<% skin html %>
<% view $name uses model::${uses} extends base %>

<% template body_content() %>
hello!
<% end template %>

<% end view %>
<% end skin %>
EOF
	exec_cmd "$facility" "add" "$file"
)
}
